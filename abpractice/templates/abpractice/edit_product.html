{% extends "./base.html" %}
{% load tailwind_filters %}
{% load widget_tweaks %}
{% block content %}
{% if product %}
<table class="w-[90%] mt-20 mx-auto border-collapse block md:table">
		<thead class="block md:table-header-group">
			<tr class="border border-grey-500 md:border-none block md:table-row absolute -top-full md:top-auto -left-full md:left-auto  md:relative ">
				<th class="bg-gray-600 p-2 text-white font-bold md:border md:border-grey-500 text-left block md:table-cell">Title</th>
				<th class="bg-gray-600 p-2 text-white font-bold md:border md:border-grey-500 text-left block md:table-cell">Image</th>
				<th class="bg-gray-600 p-2 text-white font-bold md:border md:border-grey-500 text-left block md:table-cell">Description</th>
				<th class="bg-gray-600 p-2 text-white font-bold md:border md:border-grey-500 text-left block md:table-cell">Price</th>
				<th class="bg-gray-600 p-2 text-white font-bold md:border md:border-grey-500 text-left block md:table-cell">Stock</th>
				<th class="bg-gray-600 p-2 text-white font-bold md:border md:border-grey-500 text-left block md:table-cell">Category</th>
				<th class="bg-gray-600 p-2 text-white font-bold md:border md:border-grey-500 text-left block md:table-cell">Details</th>
				<th class="bg-gray-600 p-2 text-white font-bold md:border md:border-grey-500 text-left block md:table-cell">Actions</th>
			</tr>
		</thead>
		<tbody class="block md:table-row-group">
		{% for prod in product %}
<div id="snackbar-{{prod.id}}" class="fixed top-1.5 right-1.5 hidden w-[300px] mb-2 select-none border-l-4 border-green-400 bg-green-100 p-4 font-medium hover:border-green-500">Added to cart</div>

			<tr class="bg-gray-300 border border-grey-500 md:border-none block md:table-row">
				<td class="p-2 md:border md:border-grey-500 text-left block md:table-cell">{{prod.title}}</td>
				<td class="p-2 md:border md:border-grey-500 text-left block md:table-cell"><img class="w-[100px]" src="{{prod.photo.url}}" /></td>
				<td class="p-2 md:border md:border-grey-500 text-left block md:table-cell">{{prod.description}}</td>
				<td class="p-2 md:border md:border-grey-500 text-left block md:table-cell">{{prod.price}}</td>
				<td class="p-2 md:border md:border-grey-500 text-left block md:table-cell">{{prod.in_stock}}</td>
                <td class="p-2 md:border md:border-grey-500 text-left block md:table-cell">{{prod.category}}</td>
                <td class="p-2 md:border md:border-grey-500 text-left block md:table-cell">
                    <a href="{{prod.specs.url}}" download>
                        <button class="bg-green-500 hover:bg-green-600 text-white font-bold py-1 px-2 border border-green-500 rounded">
                            Download
                        </button>
                    </a>
                </td>
				<td class="p-2 md:border md:border-grey-500 text-left block md:table-cell">
					<span class="inline-block w-1/3 md:hidden font-bold">Actions</span>
					{% if user.is_staff %}
                    <button onclick="modalHandler(true,{{prod.id}})" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 border border-blue-500 rounded">Edit</button>
					<form method="post" action="{% url 'delete' prod.id %}" class="inline">
					{% csrf_token %}
						<button type="submit" class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 border border-red-500 rounded">Delete</button>
					</form>
                    {% else %}
                    <form class="inline" id="{{prod.id}}">
					{% csrf_token %}
                        <input name="quantity" type="number" class="hidden" value="1">
                        <input name="title" class="hidden" value="{{prod.title}}">
                        <input name="product_id" class="hidden" value="{{prod.id}}">
                        <input name="user_id" class="hidden" value="{{user.id}}">
                        <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1 px-2 border border-yellow-500 rounded">Add to cart</button>
						</form>
                    {% endif %}
				</td>
			</tr>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script type="text/javascript">
    $('#{{prod.id}}').on('submit', function(event){
    event.preventDefault();
    var serializedData = $(this).serialize();
    $.ajax(
    {
        type:"POST",
        url: "",
        data: serializedData,
        success: function( data )
        {
             var a= 'snackbar-{{prod.id}}';
             var x = document.getElementById(a);
             x.innerHTML=data.res;
             x.classList.remove("hidden");
             setTimeout(function(){ x.classList.add("hidden"); }, 2000);
        }
     })
});
</script>


		{% endfor %}
		</tbody>
	</table>

<!-- component -->
<!-- inner-MOodel Code block starts -->
<div id="menu" class="z-50 w-full h-full bg-gray-900 bg-opacity-80 hidden top-0 fixed sticky-0">
    <div class="2xl:container  2xl:mx-auto py-48 px-4 md:px-28 flex justify-center items-center">
      <div class="w-96 md:w-auto dark:bg-gray-800 relative flex flex-col justify-center items-center bg-white py-16 px-4 md:px-24 xl:py-24 xl:px-36">
        <div role="banner">

        </div>
        <div class="">
          <h1 role="main" class="text-3xl dark:text-white lg:text-4xl font-semibold leading-7 lg:leading-9 text-center text-gray-800">Add collection</h1>
        </div>
        <div class="mt">
          <form id="cat-form">
            {% csrf_token %}
<!--          {{cat_form|crispy}}-->
               {{cat_form.category_name.label_tag}}
              {% render_field cat_form.category_name|add_class:"mb-2 focus:outline-none border-b w-full pb-2 border-sky-400 placeholder-gray-500" placeholder="Category Name"%}

            <input type="submit" class="mt-6 w-full flex justify-center bg-purple-800  hover:bg-purple-700 text-gray-100 p-3  rounded-lg tracking-wide font-semibold  cursor-pointer transition ease-in duration-500">
          </form>
          </div>
         <button onclick="showMenu(true)" class="text-gray-800 dark:text-gray-400 absolute top-8 right-8 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-800" aria-label="close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18" stroke="currentColor" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M6 6L18 18" stroke="currentColor" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </button>
      </div>
    </div>
  </div>
<!-- inner-MOodel Code block ends -->

{% for prod in product %}
            <div class="py-12 bg-gray-700/50 hidden transition duration-150 ease-in-out z-10 absolute top-0 right-0 left-0" id="modal-{{prod.id}}">
                <div role="alert" class="container mx-auto w-11/12 md:w-2/3 max-w-lg">
                    <div class="relative py-8 px-5 md:px-10 bg-white shadow-md rounded border border-gray-400">

                        <h1 class="text-gray-800 font-lg font-bold tracking-normal leading-tight mb-4">Update product</h1>
                        <form action="{% url 'update' prod.id %}" method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                        <label for="title" class="text-gray-800 text-sm font-bold leading-tight tracking-normal">Title</label>
                        <input id="title" name="title" class="mb-5 mt-2 text-gray-600 focus:outline-none focus:border focus:border-indigo-700 font-normal w-full h-10 flex items-center pl-3 text-sm border-gray-300 rounded border" value="{{prod.title}}" />
                         <label class="text-gray-800 text-sm font-bold leading-tight tracking-normal">Image</label>
                       <img  class="w-[100px]" src="{{prod.photo.url}}">
                        <div class="mb-5 mt-2 text-gray-600 focus:outline-none focus:border focus:border-indigo-700 font-normal w-full h-10 flex items-center pl-3 text-sm border-gray-300 rounded border" >
                        <input type="file" name="photo" id="img"/>
                         </div>
                            <label for="description" class="text-gray-800 text-sm font-bold leading-tight tracking-normal">Description</label>
                        <input id="description" name="description" class="mb-5 mt-2 text-gray-600 focus:outline-none focus:border focus:border-indigo-700 font-normal w-full h-10 flex items-center pl-3 text-sm border-gray-300 rounded border" value="{{prod.description}}" />
                         <label for="price" class="text-gray-800 text-sm font-bold leading-tight tracking-normal">Price</label>
                        <input id="price" type="number" name="price" class="mb-5 mt-2 text-gray-600 focus:outline-none focus:border focus:border-indigo-700 font-normal w-full h-10 flex items-center pl-3 text-sm border-gray-300 rounded border" value="{{prod.price}}" />
                         <label for="in_stock" class="text-gray-800 text-sm font-bold leading-tight tracking-normal">In stock</label>
                        <input id="in_stock" type="number" min="1" name="in_stock" class="mb-5 mt-2 text-gray-600 focus:outline-none focus:border focus:border-indigo-700 font-normal w-full h-10 flex items-center pl-3 text-sm border-gray-300 rounded border" value="{{prod.in_stock}}" />
                            <label class="text-gray-800 text-sm font-bold leading-tight tracking-normal">Product Details</label>
                            <p>{{prod.specs}}</p>
                            <div class="mb-5 mt-2 text-gray-600 focus:outline-none focus:border focus:border-indigo-700 font-normal w-full h-10 flex items-center pl-3 text-sm border-gray-300 rounded border" >
                        <input type="file" name="specs" id="detail"/>
                         </div>
                         <label for="category" class="text-gray-800 text-sm font-bold leading-tight tracking-normal">Category</label>

                            <select class="mb-5 mt-2 text-gray-600 focus:outline-none focus:border focus:border-indigo-700 font-normal w-full h-10 flex items-center pl-3 text-sm border-gray-300 rounded border" name="category" id="category">
                                 {% for cat in category %}
                              <option  value="{{cat.id}}" {% if cat == prod.category %} selected {% endif %}>{{cat}}</option>
                                {% endfor %}
                            </select>


                        <div class="flex items-center justify-start w-full">
                            <button type="submit" class="focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-700 transition duration-150 ease-in-out hover:bg-indigo-600 bg-indigo-700 rounded text-white px-8 py-2 text-sm">Update</button>
                            <button class="focus:outline-none focus:ring-2 focus:ring-offset-2  focus:ring-gray-400 ml-3 bg-gray-100 transition duration-150 text-gray-600 ease-in-out hover:border-gray-400 hover:bg-gray-300 border rounded px-8 py-2 text-sm" onclick="modalHandler(false,{{prod.id}})">Cancel</button>
                        </div>
                        <button class="cursor-pointer absolute top-0 right-0 mt-4 mr-5 text-gray-400 hover:text-gray-600 transition duration-150 ease-in-out rounded focus:ring-2 focus:outline-none focus:ring-gray-600" onclick="modalHandler(false,{{prod.id}})" aria-label="close modal" role="button">
                            <svg  xmlns="http://www.w3.org/2000/svg"  class="icon icon-tabler icon-tabler-x" width="20" height="20" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" />
                                <line x1="18" y1="6" x2="6" y2="18" />
                                <line x1="6" y1="6" x2="18" y2="18" />
                            </svg>
                        </button>
                        </form>
                    </div>
                </div>
            </div>
{% endfor %}
{% else %}
<p>No data to show</p>
{% endif %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script type="text/javascript">
    $('#cat-form').on('submit', function(event){
    event.preventDefault();
    var serializedData = $(this).serialize();
    $.ajax(
    {
        type:"POST",
        url: "",
        data: serializedData,
        success: function(data)
        {
            var successHtml = $($.parseHTML(data.html)).find("#category").html();
            $("#category").html(successHtml);

            let menu = document.getElementById("menu");
            menu.classList.toggle("hidden");

            document.getElementById('id_category_name').value = '';
            var x = document.getElementById("category");
            var option = document.createElement("option");
            option.id = "hello";
            option.innerHTML ='<p>Add new Category</p>'
            x.add(option);

<!--            var x = document.getElementById("snackbar");-->
<!--            x.classList.remove("hidden");-->
<!--            setTimeout(function(){ x.classList.add("hidden"); }, 2000);-->

        }
     })
});
</script>

<script>
  var x = document.getElementById("category");
  var option = document.createElement("option");
  option.id = "hello";
  option.innerHTML ='<p>Add new Category</p>'
  x.add(option);
</script>
<script>
  const select = document.getElementById("category");
  select.addEventListener('change', function handleChange(event) {
  console.log(event.target.value);
  if(event.target.value == "Add new Category"){
  showMenu(true)
  document.getElementById("category").selectedIndex = 0;
  }
});
</script>
<script>
let menu = document.getElementById("menu");
const showMenu = (flag) => {
  menu.classList.toggle("hidden");
};

</script>


            <script>

                function modalHandler(val,prod='') {
                var a= 'modal-'
                var b=a.concat(prod)
                let modal = document.getElementById(b);
                    if (val) {
                        fadeIn(modal);
                    } else {
                        fadeOut(modal);
                    }
                }
                function fadeOut(el) {
                    el.style.opacity = 1;
                    (function fade() {
                        if ((el.style.opacity -= 0.1) < 0) {
                            el.style.display = "none";
                        } else {
                            requestAnimationFrame(fade);
                        }
                    })();
                }
                function fadeIn(el, display) {
                    el.style.opacity = 0;
                    el.style.display = display || "flex";
                    (function fade() {
                        let val = parseFloat(el.style.opacity);
                        if (!((val += 0.2) > 1)) {
                            el.style.opacity = val;
                            requestAnimationFrame(fade);
                        }
                    })();
                }
            </script>

{% endblock %}
